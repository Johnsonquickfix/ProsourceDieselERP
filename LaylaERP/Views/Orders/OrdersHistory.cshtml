
@{
    ViewBag.Title = "OrdersHistory";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- datatables CSS -->
<link href="~/Content/AdminLTE-3.1.0/datatables/DataTables-1.10.20/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/AdminLTE-3.1.0/datatables/Buttons-1.6.1/css/buttons.dataTables.min.css" rel="stylesheet" />
<!-- datatables js -->
<script src="~/Content/AdminLTE-3.1.0/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/Content/AdminLTE-3.1.0/datatables/DataTables-1.10.20/js/dataTables.bootstrap.min.js" type="text/javascript"></script>

<h2>OrdersHistory</h2>

<div class="tab">
    <button class="tablinks" onclick="openCity(event, 'Listing')">Orders Listing</button>
    <button class="tablinks" onclick="openCity(event, 'Details')">Order Details</button>
    <button class="tablinks" onclick="openCity(event, 'Address')">Order Address</button>
</div>

<!-- Tab content -->
@*<div id="Listing" class="tabcontent">
        <h3>Orders Listing</h3>
        <p></p>
    </div>

    <div id="Details" class="tabcontent">
        <h3>Order Details</h3>
        <p></p>
    </div>

    <div id="Address" class="tabcontent">
        <h3>Order Address</h3>
        <p></p>
    </div>*@

<div class="row">
    <div class="col-md-12">
        <table id="dtdata" class="table table-bordered table-striped dataTable " width="100%">
            <thead>
                <tr>
                    <th><input type="checkbox" name="checkall" id="checkall"> check all</th>
                    <th>Order ID</th>
                    <th>Customer ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>No. of Items</th>
                    <th>Order Total</th>
                    <th>Status</th>
                    <th>Creation Date</th>
                    <th></th>
                </tr>
            </thead>
        </table>
    </div>
</div>
@*<script src="@Url.Content("~/js/Orders/OrderHistory.js?v="+DateTime.Now.ToString("ddMMyyyymmss")+"")" asp-append-version="true"></script>*@
<script>
    $(document).ready(function () {
        dataGridLoad();
    });
    function dataGridLoad() {
        var urid = parseInt($("#ddlSearchStatus").val()) || 0;
        var sid = ""//$('#txtSearch').val() ;
        var obj = { user_status: urid, Search: sid, PageNo: 0, PageSize: 10, sEcho: 1, SortCol: 'id', SortDir: 'desc' };
        $('#dtdata').DataTable({
            columnDefs: [{ "orderable": false, "targets": 0 }], order: [[1, "desc"]],
            destroy: true, bProcessing: true, bServerSide: true,
            sPaginationType: "full_numbers", searching: true, ordering: true, lengthChange: true,
            bAutoWidth: true, scrollX: true, scrollY: ($(window).height() - 215),
            lengthMenu: [[10, 20, 50], [10, 20, 50]],
            sAjaxSource: "/Orders/GetOrderList",
            fnServerData: function (sSource, aoData, fnCallback, oSettings) {
                obj.Search = aoData[45].value;
                var col = 'order_id';
                if (oSettings.aaSorting.length > 0) {
                    var col = oSettings.aaSorting[0][0] == 2 ? "customer_id" : oSettings.aaSorting[0][0] == 3 ? "FirstName" : oSettings.aaSorting[0][0] == 4 ? "LastName" : oSettings.aaSorting[0][0] == 5 ? "num_items_sold" : oSettings.aaSorting[0][0] == 6 ? "total_sales" : oSettings.aaSorting[0][0] == 6 ? "status" : oSettings.aaSorting[0][0] == 6 ? "date_created" : "order_id";
                    obj.SortCol = col; obj.SortDir = oSettings.aaSorting.length > 0 ? oSettings.aaSorting[0][1] : "desc";
                }
                obj.sEcho = aoData[0].value; obj.PageSize = oSettings._iDisplayLength; obj.PageNo = oSettings._iDisplayStart;
                $.ajax({
                    type: "POST", url: sSource, async: true, contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(obj),
                    success: function (data) {
                        var dtOption = { sEcho: data.sEcho, recordsTotal: data.recordsTotal, recordsFiltered: data.recordsFiltered, iTotalRecords: data.iTotalRecords, iTotalDisplayRecords: data.iTotalDisplayRecords, aaData: JSON.parse(data.aaData) };
                        return fnCallback(dtOption);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) { alert(errorThrown); },
                    async: false
                });
            },
            aoColumns: [
                {
                    'data': 'chkorder', sWidth: "5%   ",
                    'render': function (data, type, full, meta) {
                        return '<input type="checkbox" name="CheckSingle" id="CheckSingle" onClick="Singlecheck();" value="' + $('<div/>').text(data).html() + '"><label></label>';
                    }
                },
                { data: 'chkorder', title: 'OrderID', sWidth: "8%" },
                { data: 'customer_id', title: 'Customer ID', sWidth: "8%" },
                { data: 'FirstName', title: 'First Name', sWidth: "10%" },
                { data: 'LastName', title: 'Last Name', sWidth: "10%" },
                { data: 'num_items_sold', title: 'No. of Items', sWidth: "10%" },
                { data: 'total_sales', title: 'Order Total', sWidth: "10%" },
                { data: 'status', title: 'Status', sWidth: "10%" },
                { data: 'date_created', title: 'Creation Date', sWidth: "10%" },
                {
                    'data': 'chkorder', sWidth: "8%",
                    'render': function (id, type, full, meta) {
                        return '<a href="../Customer/NewUser/' + id + '"><i class="glyphicon glyphicon-pencil"></i></a>'
                    }
                }
            ]
        });
    }
</script>