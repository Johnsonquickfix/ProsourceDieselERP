@{
    ViewBag.Title = "List Financial Accounts";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.rangePicker = "/Content/AdminLTE-3.1.0/bower_components/bootstrap-daterangepicker/daterangepicker.css";
}
<link href="~/Content/DataTables/bootstrap-datepicker.css" rel="stylesheet" />
<script src="~/Content/DataTables/bootstrap-datepicker.js"></script>

<link href="~/Content/AdminLTE-3.1.0/datatables/DataTables-1.10.20/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/AdminLTE-3.1.0/datatables/Buttons-1.6.1/css/buttons.dataTables.min.css" rel="stylesheet" />
@*datatables js*@
<script src="~/Content/AdminLTE-3.1.0/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/Content/AdminLTE-3.1.0/datatables/DataTables-1.10.20/js/dataTables.bootstrap.min.js" type="text/javascript"></script>

<div class="page-title">
    <h2>Bank Accounts</h2><h2 id="txtbankaccountname"></h2>
    <span title="Click here to back to bank list" data-placement="bottom" data-toggle="tooltip">@Html.ActionLink("Back to List", "BankAccountList", null, new { @class = "btn btn-danger" })</span>
</div>
<section class="content section-content massstocktransfer commercial_proposal mt-1" id="bank_account_section">
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#tab_1" data-toggle="tab"><span title="Bank account" data-placement="bottom" data-toggle="tooltip">Bank account</span></a></li>
            <li><a href="#tab_2" data-toggle="tab"><span title="Bank entries" data-placement="bottom" data-toggle="tooltip">Bank Entries</span></a></li>
            @* <li><a href="#tab_3" data-toggle="tab"><span title="Entries" data-placement="bottom" data-toggle="tooltip">Entries</span></a></li>
                <li><a href="#tab_4" data-toggle="tab">Monthly reporting</a></li>
                    <li><a href="#tab_6" data-toggle="tab">Account statements</a></li>*@
            <li><a href="#tab_4" data-toggle="tab"><span title="Pending entries" data-placement="bottom" data-toggle="tooltip">Pending Entries</span></a></li>
            <li><a href="#tab_8" data-toggle="tab"><span title="Fund Transfer" data-placement="bottom" data-toggle="tooltip">Fund Transfer</span></a></li>
            <li><a href="#tab_7" data-toggle="tab"><span title="Linked files" data-placement="bottom" data-toggle="tooltip">Linked files</span></a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="tab_1">
                <div class="box box-primary">
                    @*<div class="box-header">*@
                    @*<div class="d-flex proposal-top">
                            <div class="edit-proposal-box">
                                <div class="proposal-box">
                                    <input type="file" name="file" id="proposal" class="inputfile">
                                    <label for="proposal"><i class="fas fa-landmark"></i></label>
                                </div>
                                <div class="edit-proposal-texts">
                                    <h3 class="box-title">#101</h3>
                                    <p>Capital One</p>
                                    <p><i class="fas fa-map-marker-alt" aria-hidden="true"></i>United States</p>
                                </div>
                            </div>
                            <div class="back-to-list">
                                <p><button class="btn btn-danger">Back to list</button></p>
                                <p><button class="btn btn-danger">Open</button></p>
                            </div>
                        </div>*@
                    @*</div>*@
                </div>

                <div class="row" style="background-color:white">
                    <div class="col-md-4">
                        <input type="hidden" id="hfid" value="@ViewBag.id" />
                        <div class="form-group">
                            <label for="bankcash">Bank or Cash Label</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtbankcashlabel" placeholder="Enter Bank or Cash Label">
                        </div>
                        <div class="form-group">
                            <label for="accounttype">Account Type</label><span style="color:red">*</span>
                            <select class="form-control" id="txtaccounttype">
                                <option value="1">Saving Account</option>
                                <option value="2">Current or Credit Card Account</option>
                                <option value="3">Cash Account</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bankstatus">Status</label><span style="color:red">*</span>
                            <select class="form-control" id="txtbankstatus">
                                <option value="1">Open</option>
                                <option value="0">Close</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="accountcountry">Account Country</label><span style="color:red">*</span>
                            <select class="form-control" id="txtaccountcountry">
                                <option selected value="US">United States</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="state">State/Province</label><span style="color:red">*</span>
                            <input class="form-control" type="text" id="txtstate" />
                            @*<select class="form-control" id="txtstate">
                                    <option selected value="NY">New York</option>
                                </select>*@
                        </div>

                        <div class="form-group">
                            <label for="tag">Web</label><span style="color:red"></span>
                            <input class="form-control" type="text" id="txtweb" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Comment</label><span style="color:red"></span>
                            <input class="form-control" type="text" id="txtcomment" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Initial balance</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtinitial" />
                        </div>

                    </div>

                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="tag">Date</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtdate" /><span class="even-space"></span>
                        </div>

                        <div class="form-group">
                            <label for="tag">Minimum allowed balance</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtminallowbalance" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Minimum desired balance</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtdesiredbalance" />
                        </div>


                        <div class="form-group">
                            <label for="tag">Bank name</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtbankname" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Bank Code</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtbankcode" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Account Number</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtaccountnumber" />
                        </div>

                        <div class="form-group">
                            <label for="tag">IBAN Account Number</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtIBAN" />
                        </div>

                        <div class="form-group">
                            <label for="tag">BIC/SWIFT code</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtBIC" />
                        </div>

                    </div>

                    <div class="col-sm-4">

                        <div class="form-group">
                            <label for="tag">Currency</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtcurrency" value="USD" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Bank address</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtbankaddress" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Account owner name</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtaccountowner" />
                        </div>

                        <div class="form-group">
                            <label for="tag">Account owner address</label><span style="color:red">*</span>
                            <input type="text" class="form-control" id="txtowneraddress" />
                        </div>
                        <div class="form-group">
                            <label for="tag">Accounting Account</label><span style="color:red">*</span>
                            <select class="form-control select2" id="ddlaccounting">
                                @*<option value="1">Assets</option>*@
                            </select>
                        </div>

                        <div class="form-group" style="display:none">
                            <label for="tag">Accounting code journal</label><span style="color:red">*</span>
                            <select class="form-control select2" id="ddljournal">
                            </select>
                        </div>

                        <a href="#" class="btn btn-danger" id="btnSave"><span title="Click here to update" data-placement="bottom" data-toggle="tooltip"><b>Update</b></span></a>
                    </div>


                </div>
            </div>


            <!--Tab 1 End -->
            <div class="tab-pane" id="tab_2">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="box box-primary">
                            <div class="box-header">
                                <div class="form-inline">
                                    <div class="input-group">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        <input id="txtOrderDate" data-auto-update-input="false" readonly="readonly" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box box-primary">
                    <div class="box-body">
                        <div class="col-md-4">
                            <div class="form-group bxa">
                                <span><i class="fas fa-file-invoice-dollar"></i>OPEN ACCOUNT INITIAL BALANCE</span>
                                <h3 id="txtinitialamount"></h3>
                            </div>
                        </div>
                        <div class="col-md-4" style="text-align:end">
                            <div class="form-group bxa">
                                <span><i class="fas fa-file-invoice-dollar"></i>Uncleared Balance</span>
                                <h3 id="txtunclearbalance"></h3>
                            </div>
                        </div>
                        <div class="col-md-4" style="text-align:right">
                            <div class="form-group bxa">
                                <span><i class="fas fa-file-invoice-dollar"></i>Current Balance</span>
                                <h3 id="txtbalance"></h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row rowbox proposal-row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-body">
                                <div class="table-responsive bank-table-wrapper">
                                    <table id="tbBankEntry" class="table-blue table check-table table-bordered table-striped">
                                        <thead>
                                            @*<tr>
                                                <th>Ref</th>
                                                <th>Oper. Date</th>
                                                <th>Vaue Date</th>
                                                <th>Payment Type</th>
                                                <th>Number</th>
                                                <th>Vendor</th>
                                                <th>Invoice</th>
                                                <th>Debit</th>
                                                <th>Credit</th>
                                                <th>Balance</th>
                                            </tr>*@
                                        </thead>
                                        @*<tfoot align="right">
                                                <tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr>
                                            </tfoot>*@
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @*<div class="row">
                        <div class="col-sm-12">
                            <div class="box box-primary">
                                <div class="box-header">
                                    <div class="form-group group-test">
                                        <label class="col-sm-3 control-label">Grand Total</label>
                                        <div class="col-sm-9">
                                            <span class="col-sm-4 control-label" id="txtentriesdebit" style="font-weight:bold"></span><span class="col-sm-3 control-label" id="txtentriescredit" style="font-weight:bold"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@

                @*<div class="row">
                        <div class="col-sm-12">
                            <div class="box box-primary">
                                <div class="box-header">
                                    <div class="form-group group-test">
                                        <label class="col-sm-3 control-label">Balance</label>
                                        <div class="col-sm-9">
                                            <span class="col-sm-3 control-label" id="txtbalance" style="font-weight:bold"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@

            </div>
            <div class="tab-pane" id="tab_3">
                <div class="row rowbox proposal-row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-body">
                                <div class="table-responsive bank-table-wrapper">
                                    <br />
                                    <table id="entries" class="table-blue table check-table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Due Date</th>
                                                <th>Description</th>
                                                <th>Third Party</th>
                                                <th>Debit</th>
                                                <th>Credit</th>
                                                <th>Balance</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="tab_4">
                <div class="box box-primary">
                    <div class="box-header">
                        <div class="col-md-3">
                            <div class="form-group bxa">
                                <span><i class="fas fa-file-invoice-dollar"></i>Uncleared Balance</span>
                                <h3 id="txtpendingbalance"></h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row rowbox proposal-row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-body">
                                <div class="table-responsive bank-table-wrapper">
                                    <table id="PendingBankEntriesdata" class="table-blue table check-table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Ref</th>
                                                <th>Oper. Date</th>
                                                <th>Vaue Date</th>
                                                <th>Payment Type</th>
                                                <th>Number</th>
                                                <th>Vendor</th>
                                                <th>Bank Account</th>
                                                <th>Debit</th>
                                                <th>Credit</th>
                                            </tr>
                                        </thead>
                                        @*<tfoot align="right">
                                                <tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr>
                                            </tfoot>*@
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="tab_8">
                <div class="box-header">
                    <div class="form-inline">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            <input id="txtOrderDate1" data-auto-update-input="false" readonly="readonly" class="form-control">
                        </div>
                        <a href="#" class="btn btn-danger" id="btnSaveFundTransfer"><span title="Click here to fund transfer" data-placement="bottom" data-toggle="tooltip"><b>Fund transfer</b></span></a>
                    </div>
                </div>
                <div class="row rowbox proposal-row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-body">
                                <div class="table-responsive bank-table-wrapper">
                                    <input type="hidden" id="accounting_account" />
                                    <table id="FundTransferdata" class="table-blue table check-table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th><input type="checkbox" name="checkAll" id="checkAll"><label></label></th>
                                                <th>Date</th>
                                                <th>Inv Num</th>
                                                <th>Oper. Date</th>
                                                <th>Debit</th>
                                                <th>Credit</th>
                                            </tr>
                                        </thead>
                                        @*<tfoot align="right">
                                                <tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr>
                                            </tfoot>*@
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="tab_7">
                <div class="box box-primary">
                    <div class="box-body">
                        <table class="table-blue table check-table table-bordered inventory-table fixed-table">
                            <tbody>
                                <tr>
                                    <td class="titlefield">Number of attached files/documents</td>
                                    <td class="text-left" colspan="3" id="lblAttachedFiles"> <label id="lblAttachedFiles" for="javascript"></label></td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row rowbox proposal-row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <label class="control-label">Attach a new file/document</label>
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="col-md-6">
                                            <input type="file" name="ImageFile" class="form-control" id="ImageFile" />
                                        </div>
                                        <div class="col-md-6 left">
                                            <input type="button" id="btnupload" title="Click here for the file upload" data-placement="bottom" data-toggle="tooltip" class="btn btn-danger" value="Upload" />
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="box-body">
                                <div class="mb-35">
                                    <label class="control-label">Attached files and documents</label>

                                    <div class="table-responsive bank-table-wrapper">
                                        <table id="LinkedFiles" class="inventory-table table-blue table check-table table-bordered table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Document Name</th>
                                                    <th>Size</th>
                                                    <th>Date</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                @*<div id="linkWarehouse">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="box-body">
                                    <label class="control-label col-sm-1">Warehouse</label>
                                    <div class="form-group col-sm-6">

                                        <select class="form-control" id="ddlWarehouseList"></select>
                                    </div>

                                    <button type="button" id="btnLinkWarehouse" class="btn btn-danger ">Add</button>

                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="box box-primary">
                                    <div class="box-header">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <table id="Warehousedata" class="inventory-table table-blue table check-table table-bordered table-striped dataTable" style="width:100%;">
                                                    <thead>
                                                        <tr style="text-align:center;">
                                                            <th>Vendor Name</th>
                                                            <th>Warehouse</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-footer">
                            <div class="text-right">
                                @Html.ActionLink("Back to List", "VendorList", null, new { @class = "btn btn-danger" })
                            </div>
                        </div>
                    </div>*@
            </div>
        </div>
    </div>
</section>


<script>
    $(document).ready(function () {
        var url = window.location.pathname;
        var id = url.substring(url.lastIndexOf('/') + 1);
        setTimeout(function () { GetAccountByID(id); }, 1000);

        $(document).on('click', "#btnSave", function () {
            UpdateBankAccount();
        });

        $(".select2").select2();
        //getAccountingAccount();
        //setTimeout(function () { $(".select2").select2(); }, 2000);
        //$(".select2").select2();
        isEdit(true);

        $("#btnSaveFundTransfer").click(function () { Bankfundtransfer(); })
    });

    function isEdit(val) {
        localStorage.setItem('isEdit', val ? 'yes' : 'no');
    }
</script>




<script>
    function GetAccountByID(id) {
        var rowid = id;
        var obj =
            $.ajax({
                url: "/Bank/GetAccountByID/" + rowid,
                type: "GET",
                contentType: "application/json; charset=utf-8",
                dataType: 'JSON',
                data: JSON.stringify(obj),
                success: function (data) {
                    //console.log(data);

                    var d = JSON.parse(data);
                    if (d.length > 0) {
                        $("#hfid").val(d[0].rowid);
                        $("#txtbankaccountname").text('( ' + d[0].label + ' - ' + d[0].account_number + ' )');
                        $("#txtbankcashlabel").val(d[0].label);
                        $("#txtaccounttype").val(d[0].account_type);
                        $("#txtbankstatus").val(d[0].working_status);
                        $("#txtaccountcountry").val(d[0].country_iban);
                        $("#txtstate").val(d[0].state);
                        $("#txtweb").val(d[0].url);
                        $("#txtcomment").val(d[0].comment);
                        $("#txtinitial").val(d[0].initial_balance);
                        $("#txtdate").val(d[0].date_created);
                        $("#txtminallowbalance").val(d[0].min_allowed);
                        $("#txtdesiredbalance").val(d[0].min_desired);
                        $("#txtbankname").val(d[0].bank);
                        $("#txtbankcode").val(d[0].code_bank);
                        $("#txtaccountnumber").val(d[0].account_number);
                        $("#txtIBAN").val(d[0].iban_prefix);
                        $("#txtBIC").val(d[0].bic);
                        $("#txtbankaddress").val(d[0].bank_address);
                        $("#txtaccountowner").val(d[0].owner_name);
                        $("#txtowneraddress").val(d[0].owner_address);
                        setTimeout(function () { $("#ddlaccounting").val(d[0].accounting_number).trigger('change') }, 500);
                        $("#ddljournal").val(d[0].fk_accountancy_journal).trigger('change');
                        $("#txtcurrency").val(d[0].currency_code);
                        //$("#txtinitialamount").text('$' + (d[0].open_balance));
                        $("#accounting_account").val(d[0].accounting_number);
                        BankLinkedFiles();

                    }
                },
                error: function (msg) {

                }
            });

    }
</script>
<link href="~/Content/AdminLTE-3.1.0/daterangepicker/daterangepicker.monthpicker.css" rel="stylesheet" />
<script src="~/Content/AdminLTE-3.1.0/daterangepicker/daterangepicker.monthpicker.js"></script>
<script src="~/js/common.js?v=1.0"></script>
<script src="@Url.Content("~/js/Bank/Bank.js?v="+DateTime.Now.ToString("ddMMyyyymmss")+"")" asp-append-version="true"></script>
<script src="@Url.Content("~/js/Bank/BankEntries.js?v="+DateTime.Now.ToString("ddMMyyyymmss")+"")" asp-append-version="true"></script>
<script>
    $(function () {
        $("#txtdate").datepicker({
            format: 'mm-dd-yyyy',
        });

    });
</script>

