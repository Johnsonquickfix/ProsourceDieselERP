@model LaylaERP.Models.qfk.Common.ProfileResponse
@{
    ViewBag.Title = "ProfileView";
    Layout = "~/Views/Shared/_qfk_Layout.cshtml";
}
<link href="~/Content/AdminLTE-3.1.0/datatables/DataTables-1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
<link href="~/Content/AdminLTE-3.1.0/datatables/Buttons-1.6.1/css/buttons.dataTables.min.css" rel="stylesheet" />
<!-- datatables js -->
<script src="~/Content/AdminLTE-3.1.0/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/Content/AdminLTE-3.1.0/datatables/DataTables-1.10.20/js/dataTables.bootstrap4.min.js" type="text/javascript"></script>
<style>
    .event_properties {
        border-radius: 2px;
        background-color: #F3F6F7;
        overflow-x: auto;
        display: flex;
        padding: 16px;
        flex-direction: column;
    }
</style>
<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            @if (string.IsNullOrEmpty(Model.FirstName))
            {
                <h4 class="mb-sm-0 font-size-18">@Model.Email</h4>
            }
            else
            {
                <h4 class="mb-sm-0 font-size-18">@Model.FirstName @Model.LastName</h4>
            }
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="/audience/profiles">Audience</a></li>
                    <li class="breadcrumb-item active">Profiles</li>
                </ol>
            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-7">
        <div class="card boxed_style">
            <div class="card-body">
                <div class="mb-2 flex-grow-1 border-bottom">
                    <div class="mb-3 row">
                        <label for="example-text-input" class="col-md-2 col-form-label">Show</label>
                        <div class="col-md-6">
                            <select id="metrics" class="select2" style="width:100%" data-profileid="@ViewBag.id">
                                <option value="0" data-icon="api">All Metrics</option>
                                @foreach (var o in @Model.metrics)
                                {
                                    <option value="@o.metric_id">@o.metric_name</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="my-4 flex-grow-1">
                    <ul id="activity-feed" class="verti-timeline list-unstyled">
                        <li class="text-center"><h4>Loging activities....</h4></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-5">
        <div class="card boxed_style">
            <div class="card-body">
                <h2 class="h2-title">METRICS</h2>
                <table id="matrics-list" class="table">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-end">30</th>
                            <th class="text-end">All-Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var o in @Model.metrics)
                        {
                            <tr>
                                <td class="metric-label">
                                    @o.metric_name
                                </td>
                                <td class="text-end">
                                    <div class="loading-metric"><span>@o.last_30d</span></div>
                                </td>
                                <td class="text-end" style="color: rgb(0, 0, 0);">@o.all_time</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card boxed_style">
            <div class="d-flex align-center justify-content-between business_performance py-3">
                <h2 class="h2-title">Custom properties </h2>
                <div class="ms-auto">
                    <a id="add-custom-property" href="javascript: void(0);" class="btn btn-outline-dark">Add custom property</a>
                </div>
            </div>
            <div class="card-body pt-1">
                @if (@Model.CustomProperties == null)
                {
                    <div class="alert alert-warning"><i class="fas fa-exclamation-triangle me-2"></i>Selecting a new template will permanently delete existing content for your campaign. To avoid losing any work, <a href="">return to your current template</a></div>
                }
                else
                {
                    <table class="table dataTable no-footer" width="100%">
                        <thead>
                            <tr>
                                <th style="width:30%">Key</th>
                                <th style="width:65%">Value</th>
                                <th style="width:5%"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var o in @Model.CustomProperties)
                            {
                                <tr>
                                    <td class="metric-label">
                                        @o.meta_key
                                    </td>
                                    <td class="">
                                        <div class="loading-metric"><span>@o.meta_value</span></div>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <a class="btn btn-outline-dark" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <a class="dropdown-item" name="menu-option-edit-value" href="javascript: void(0);" data-id="@o.id" data-key="@o.meta_key" data-value="@o.meta_value">Edit value</a>
                                                <a class="dropdown-item" name="menu-option-view" href="javascript: void(0);" data-id="@o.id" data-key="@o.meta_key" data-value="@o.meta_value">View</a>
                                                <a class="dropdown-item" name="menu-option-delete" href="javascript: void(0);" data-id="@o.id">Delete</a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>}
            </div>
        </div>
        <div class="card boxed_style">
            <div class="card-body border-bottom">
                <h2 class="h2-title">INFORMATION</h2>
            </div>
            <div class="card-body">
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Profile details</h5>
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Unique ID</h5>
                    <p class="text-muted mb-0">
                        <span>@Model.id</span>
                    </p>
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Organization</h5>
                    <p class="text-muted mb-0">
                        @{
                            if (!string.IsNullOrEmpty(Model.title))
                            {
                                <span class="me-1">@Model.title</span><span>at</span>
                                if (!string.IsNullOrEmpty(Model.Organization))
                                {
                                    @Model.Organization
                                }
                                else
                                {
                                    <span>Unknown Organization</span>
                                }
                            }
                            else
                            {
                                <span>-</span>
                            }
                        }
                    </p>
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Phone Number</h5>
                    @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                    {
                        <p class="text-muted mb-0"><i class="fa fa-phone me-2"></i>@Model.PhoneNumber</p>
                    }
                    else
                    {
                        <p class="text-muted mb-0"><i class="fa fa-phone me-2"></i> (blank)</p>
                    }
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Location</h5>
                    <p class="text-muted mb-0">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        @{
                            var s_address = "";
                            if (!string.IsNullOrEmpty(Model.Address1)) { s_address += Model.Address1 + ", "; }
                            if (!string.IsNullOrEmpty(Model.City)) { s_address += Model.City + ", "; }
                            if (!string.IsNullOrEmpty(Model.Region)) { s_address += Model.Region + ", "; }
                            if (!string.IsNullOrEmpty(Model.Country)) { s_address += Model.Country + " "; }
                            if (!string.IsNullOrEmpty(Model.Zip)) { s_address += Model.Zip; }
                        }
                        @s_address
                    </p>
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Timezone</h5>
                    @if (!string.IsNullOrEmpty(Model.Timezone))
                    {
                        <p class="text-muted mb-0">@Model.Timezone</p>
                    }
                    else
                    {
                        <p class="text-muted mb-0">-</p>
                    }
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">IP Address</h5>
                    @if (!string.IsNullOrEmpty(Model.IP))
                    {
                        <p class="text-muted mb-0">@Model.IP</p>
                    }
                    else
                    {
                        <p class="text-muted mb-0">-</p>
                    }
                </div>
                <div class="mb-2 d-flex border-top border-bottom pt-2">
                    <div class="align-self-center overflow-hidden me-auto">
                        <h5 class="mb-0 card-title">Email</h5>
                        <p class="text-muted mb-0"><i class="bx bx-envelope me-2"></i> @Model.Email</p>
                    </div>
                    <div class="ms-2 mt-2">
                        @if (Model.is_suppressed)
                        {
                            <span class="badge bg-danger font-size-12"><i class="fas fa-ban"></i></span>
                        }
                        else
                        {
                            <span class="badge bg-success font-size-12"><i class="fas fa-check"></i></span>
                        }
                    </div>
                </div>
                <div class="mb-2 flex-grow-1">
                    <h5 class="mb-0 card-title">Activity</h5>
                </div>
                <div class="mb-2 flex-grow-1">
                    <p class="mb-1">
                        <strong>Profile Created</strong>
                        @if (Model.created.HasValue)
                        {
                            @Model.created.Value.ToString("MMMM dd, yyyy h:mm tt")
                        }
                    </p>
                    <p class="mb-1">
                        <strong>Profile Updated</strong>
                        @if (Model.updated.HasValue)
                        {
                            @Model.updated.Value.ToString("MMMM dd, yyyy h:mm tt")
                        }
                    </p>
                </div>
                <div class="mb-2 flex-grow-1 flex-grow-1">
                    <p class="mb-1">
                        <strong>First Active</strong>
                        @if (Model.first_active_on.HasValue)
                        {
                            @Model.first_active_on.Value.ToString("MMMM dd, yyyy h:mm tt")
                        }
                    </p>
                    <p class="mb-1">
                        <strong>Last Active</strong>
                        @if (Model.last_active_on.HasValue)
                        {
                            @Model.last_active_on.Value.ToString("MMMM dd, yyyy h:mm tt")
                        }
                    </p>
                </div>
                <!--<div class="mb-2 pb-2 flex-grow-1 border-bottom flex-grow-1 border-bottom">
                    <h5>Custom Properties </h5>
                    <div class="pull-right"><a href="#" class="show_add_custom_property">Add</a></div>
                </div>
                <div class="mb-2 pb-2 flex-grow-1 border-bottom">
                    <h5>How They Found You</h5>
                    <p class="mb-1"><strong>Source</strong> (direct)</p>
                    <p class="mb-1"><strong>Campaign</strong> (direct)</p>
                    <p class="mb-1"><strong>Medium</strong> —</p>
                    <p class="mb-1"><strong>Content</strong> —</p>
                    <p class="mb-1"><strong>Term</strong> —</p>
                    <p class="mb-1">
                        <strong>Referrer</strong>
                        <span title="" class="ellipsis">—</span>
                    </p>
                    <p class="mb-1"></p>
                    <p class="mb-1">
                        <strong>First Page</strong>
                        <span title="https://localhost:44373/Home/search" class="ellipsis">https://localhost:44373/Home/search</span>
                    </p>
                    <p class="mb-1"></p>
                </div>
                <div class="mb-2 pb-2 flex-grow-1 border-bottom">
                    <h4>How They Found You Most Recently</h4>
                    <p class="mb-1"><strong>Source</strong> (direct)</p>
                    <p class="mb-1"><strong>Campaign</strong> (direct)</p>
                    <p class="mb-1"><strong>Medium</strong> —</p>
                    <p class="mb-1"><strong>Content</strong> —</p>
                    <p class="mb-1"><strong>Term</strong> —</p>
                    <p class="mb-1">
                        <strong>Referrer</strong>
                        <span title="" class="ellipsis">—</span>
                    </p>
                    <p class="mb-1"></p>
                    <p class="mb-1">
                        <strong>First Page</strong>
                        <span title="https://localhost:44373/Home/search" class="ellipsis">https://localhost:44373/Home/search</span>
                    </p>
                    <p class="mb-1"></p>
                </div>-->

            </div>
        </div>
    </div>
</div>
<div id="raw_data_modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Activity Details</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    This activity was timestamped <span class="raw_data_time fw-bold"></span> and was recorded on <span class="raw_data_time fw-bold"></span>.
                    Here is the activity data:
                </div>
                <div class="raw_data_json">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script src="~/js/qfk/common.js"></script>
<script src="~/Content/AdminLTE-3.1.0/daterangepicker/moment.min.js"></script>
<script async src="@Url.Content("~/js/qfk/audience/profileview.js?v=" + DateTime.Now.ToString("ddMMyyyymmss"))" asp-append-version="true"></script>